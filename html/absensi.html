<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIMA - Detail Jadwal & Absensi</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-900 min-h-screen flex items-center justify-center p-4">

    <!-- Toast Notification -->
    <div id="toast" class="fixed top-6 left-1/2 -translate-x-1/2 z-[100] hidden">
        <div class="bg-white rounded-2xl shadow-2xl p-4 flex items-center gap-3 min-w-[300px] animate-slide-down">
            <div id="toastIcon" class="flex-shrink-0"></div>
            <div class="flex-1">
                <p id="toastTitle" class="font-semibold text-gray-900 text-sm"></p>
                <p id="toastMessage" class="text-xs text-gray-600"></p>
            </div>
        </div>
    </div>

    <!-- Modal Overlay -->
    <div class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-40"></div>

    <!-- Modal Container -->
    <div class="relative z-50 w-full max-w-md">
        <!-- Modal Content -->
        <div class="bg-white rounded-3xl shadow-2xl overflow-hidden animate-slide-up">

            <!-- Header -->
            <div class="bg-gradient-to-br from-blue-500 to-blue-600 p-6 relative">
                <button onclick="closeModal()"
                    class="absolute top-4 right-4 text-white bg-white/20 backdrop-blur-sm rounded-full p-2 hover:bg-white/30 transition">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>

                <div class="mb-4">
                    <span class="bg-white/20 backdrop-blur-sm text-white text-xs font-bold px-3 py-1 rounded-full">
                        Senin, 09 Des 2024
                    </span>
                </div>

                <h2 class="font-bold text-2xl text-white mb-2">Matematika Diskrit</h2>
                <p class="text-blue-100 text-sm">Dosen: Bu Mega Nindityawati</p>
            </div>

            <!-- Content -->
            <div class="p-6">
                <!-- Schedule Details -->
                <div class="space-y-3 mb-6">
                    <div class="flex items-center gap-3 p-3 bg-blue-50 rounded-xl">
                        <div class="bg-blue-500 p-2 rounded-lg">
                            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                        <div>
                            <p class="text-xs text-gray-600">Waktu</p>
                            <p class="font-semibold text-gray-900">10:30 - 13:00 WIB</p>
                        </div>
                    </div>

                    <div class="flex items-center gap-3 p-3 bg-green-50 rounded-xl">
                        <div class="bg-green-500 p-2 rounded-lg">
                            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                            </svg>
                        </div>
                        <div>
                            <p class="text-xs text-gray-600">Ruangan</p>
                            <p class="font-semibold text-gray-900">Ruang B3.2</p>
                        </div>
                    </div>

                    <div class="flex items-center gap-3 p-3 bg-purple-50 rounded-xl">
                        <div class="bg-purple-500 p-2 rounded-lg">
                            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                        <div>
                            <p class="text-xs text-gray-600">Sesi</p>
                            <p class="font-semibold text-gray-900">Pagi (AM)</p>
                        </div>
                    </div>
                </div>

                <!-- WiFi Status -->
                <div id="wifiStatus" class="mb-6">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="font-bold text-gray-900">Status Koneksi WiFi</h3>
                        <button onclick="checkWiFi()" class="text-blue-600 text-sm font-medium hover:text-blue-700">
                            Cek Ulang
                        </button>
                    </div>

                    <div id="wifiNotConnected" class="space-y-4">
                        <div class="p-4 bg-red-50 border border-red-200 rounded-xl flex items-start gap-3">
                            <div class="bg-red-500 p-2 rounded-lg flex-shrink-0">
                                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M18.364 5.636a9 9 0 010 12.728m0 0l-2.829-2.829m2.829 2.829L21 21M15.536 8.464a5 5 0 010 7.072m0 0l-2.829-2.829m-4.243 2.829a4.978 4.978 0 01-1.414-2.83m-1.414 5.658a9 9 0 01-2.167-9.238m7.824 2.167a1 1 0 111.414 1.414m-1.414-1.414L3 3m8.293 8.293l1.414 1.414" />
                                </svg>
                            </div>
                            <div class="flex-1">
                                <p class="font-semibold text-red-900 text-sm mb-1">Tidak Terhubung WiFi Kampus</p>
                                <p class="text-xs text-red-700 mb-2">Anda harus terhubung ke WiFi "Kampus-IT" untuk
                                    melakukan absensi hadir</p>
                                <button onclick="checkWiFi()"
                                    class="text-xs bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium transition">
                                    Coba Hubungkan
                                </button>
                            </div>
                        </div>

                        <!-- Izin Form (Available without WiFi) -->
                        <div class="border-t-2 border-gray-200 pt-4">
                            <div class="mb-4">
                                <h3 class="font-bold text-gray-900 mb-2">Atau Ajukan Izin</h3>
                                <p class="text-sm text-gray-600 mb-4">Jika Anda berhalangan hadir, silakan ajukan izin
                                    di bawah ini</p>

                                <div class="mb-4">
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                                        Nomor Induk Mahasiswa (NIM)
                                    </label>
                                    <input type="text" id="nimInputNoWifi" placeholder="Contoh: 102230039"
                                        maxlength="10"
                                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-amber-500 focus:border-transparent outline-none transition text-center text-lg font-semibold" />
                                </div>

                                <div class="mb-4">
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                                        Alasan Izin <span class="text-red-500">*</span>
                                    </label>
                                    <div class="relative">
                                        <select id="izinReasonNoWifi"
                                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-amber-500 focus:border-transparent outline-none transition appearance-none bg-white cursor-pointer pr-12 font-medium text-gray-700"
                                            onchange="toggleCustomReasonNoWifi()">
                                            <option value="" class="text-gray-400">Pilih Alasan</option>
                                            <option value="sakit">Sakit</option>
                                            <option value="keperluan_keluarga">Keperluan Keluarga</option>
                                            <option value="keperluan_kuliah">Keperluan Kuliah/Akademik</option>
                                            <option value="kegiatan_organisasi">Kegiatan Organisasi</option>
                                            <option value="lainnya">Lainnya</option>
                                        </select>
                                        <div
                                            class="absolute inset-y-0 right-0 flex items-center pr-4 pointer-events-none">
                                            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor"
                                                viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M19 9l-7 7-7-7" />
                                            </svg>
                                        </div>
                                    </div>
                                </div>

                                <div id="customReasonContainerNoWifi" class="hidden mb-4">
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                                        Detail Alasan
                                    </label>
                                    <textarea id="customReasonNoWifi" rows="3"
                                        placeholder="Jelaskan alasan izin Anda..."
                                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-amber-500 focus:border-transparent outline-none transition resize-none"></textarea>
                                </div>

                                <div class="mb-4">
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                                        Upload Surat Izin (Opsional)
                                    </label>
                                    <div class="border-2 border-dashed border-gray-300 rounded-xl p-4 text-center hover:border-amber-500 transition cursor-pointer"
                                        onclick="document.getElementById('izinFileUploadNoWifi').click()">
                                        <input type="file" id="izinFileUploadNoWifi" class="hidden"
                                            accept="image/*,.pdf" onchange="handleIzinFileSelectNoWifi(event)" />
                                        <div id="izinUploadPlaceholderNoWifi">
                                            <svg class="w-8 h-8 text-gray-400 mx-auto mb-2" fill="none"
                                                stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                                            </svg>
                                            <p class="text-xs text-gray-600 font-medium">Klik untuk upload surat</p>
                                            <p class="text-xs text-gray-400">PNG, JPG, atau PDF (Max. 5MB)</p>
                                        </div>
                                        <div id="izinFilePreviewNoWifi" class="hidden">
                                            <div
                                                class="flex items-center justify-center gap-2 bg-amber-50 rounded-lg p-2">
                                                <svg class="w-6 h-6 text-amber-600" fill="none" stroke="currentColor"
                                                    viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                                </svg>
                                                <div class="flex-1 text-left">
                                                    <p id="izinFileNameNoWifi"
                                                        class="text-xs font-medium text-gray-900"></p>
                                                </div>
                                                <button type="button" onclick="removeIzinFileNoWifi(event)"
                                                    class="text-red-500 hover:text-red-700">
                                                    <svg class="w-4 h-4" fill="none" stroke="currentColor"
                                                        viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round"
                                                            stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                                    </svg>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <button onclick="submitIzinNoWifi()" id="izinButtonNoWifi"
                                    class="w-full bg-amber-600 hover:bg-amber-700 text-white py-3.5 rounded-xl font-semibold transition shadow-lg shadow-amber-600/30 flex items-center justify-center gap-2">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                    </svg>
                                    Kirim Permohonan Izin
                                </button>
                            </div>
                        </div>
                    </div>

                    <div id="wifiConnected"
                        class="hidden p-4 bg-green-50 border border-green-200 rounded-xl flex items-center gap-3">
                        <div class="bg-green-500 p-2 rounded-lg">
                            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071c3.904-3.905 10.236-3.905 14.141 0M1.394 9.393c5.857-5.857 15.355-5.857 21.213 0" />
                            </svg>
                        </div>
                        <div class="flex-1">
                            <p class="font-semibold text-green-900 text-sm">Terhubung ke WiFi Kampus</p>
                            <p class="text-xs text-green-700">SSID: Kampus-IT • Signal: Kuat</p>
                        </div>
                        <div class="text-green-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M5 13l4 4L19 7" />
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Attendance Form (Hadir Only - WiFi Connected) -->
                <div id="attendanceForm" class="hidden">
                    <div class="mb-4">
                        <h3 class="font-bold text-gray-900 mb-3">Absensi Hadir</h3>
                        <p class="text-sm text-gray-600 mb-4">Masukkan NIM Anda untuk melakukan absensi kehadiran</p>

                        <!-- Hadir Form -->
                        <div id="hadirForm">
                            <div class="mb-4">
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Nomor Induk Mahasiswa (NIM)
                                </label>
                                <input type="text" id="nimInput" placeholder="Contoh: 102230039" maxlength="10"
                                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition text-center text-lg font-semibold" />
                            </div>
                        </div>

                        <!-- User Data Preview (Hidden until verified) -->
                        <div id="userDataPreview" class="hidden mb-4 p-4 bg-blue-50 border border-blue-200 rounded-xl">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="bg-blue-500 p-2 rounded-full">
                                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                    </svg>
                                </div>
                                <div>
                                    <p class="font-bold text-gray-900" id="verifiedName">Ahmad Rizky</p>
                                    <p class="text-sm text-gray-600" id="verifiedNim">NIM: 102230039</p>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-3 text-sm">
                                <div>
                                    <p class="text-gray-600">Program Studi</p>
                                    <p class="font-semibold text-gray-900" id="verifiedProdi">Informatika</p>
                                </div>
                                <div>
                                    <p class="text-gray-600">Angkatan</p>
                                    <p class="font-semibold text-gray-900" id="verifiedYear">2023</p>
                                </div>
                            </div>
                        </div>

                        <button onclick="verifyAndAttend()" id="attendButton"
                            class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3.5 rounded-xl font-semibold transition shadow-lg shadow-blue-600/30 flex items-center justify-center gap-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            Verifikasi & Absen
                        </button>
                    </div>
                </div>

                <!-- Info Box -->
                <div class="mt-6 p-4 bg-amber-50 border border-amber-200 rounded-xl">
                    <div class="flex items-start gap-3">
                        <svg class="w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor"
                            viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <div>
                            <p class="text-sm font-semibold text-amber-900 mb-1">Perhatian</p>
                            <p class="text-xs text-amber-700">Pastikan Anda berada di area kampus dan terhubung ke WiFi
                                Kampus-IT untuk melakukan absensi.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <style>
        @keyframes slide-up {
            from {
                opacity: 0;
                transform: translateY(100px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slide-down {
            from {
                opacity: 0;
                transform: translate(-50%, -20px);
            }

            to {
                opacity: 1;
                transform: translate(-50%, 0);
            }
        }

        .animate-slide-up {
            animation: slide-up 0.3s ease-out;
        }

        .animate-slide-down {
            animation: slide-down 0.3s ease-out;
        }
    </style>

    <script>
        // Simulasi database mahasiswa
        const studentDatabase = {
            '102230039': {
                name: 'Ahmad Rizky',
                nim: '102230039',
                prodi: 'Informatika',
                year: '2023'
            },
            '102230040': {
                name: 'Siti Nurhaliza',
                nim: '102230040',
                prodi: 'Sistem Informasi',
                year: '2023'
            },
            '102230041': {
                name: 'Budi Santoso',
                nim: '102230041',
                prodi: 'Informatika',
                year: '2023'
            }
        };

        // Simulasi user yang sedang login
        const currentUser = {
            name: 'Ahmad Rizky',
            nim: '102230039',
            prodi: 'Informatika',
            year: '2023'
        };

        let isWifiConnected = false;

        function closeModal() {
            alert('Modal ditutup');
            // Dalam implementasi sebenarnya, ini akan menutup modal
        }

        // Functions for No-WiFi Izin Form
        function toggleCustomReasonNoWifi() {
            const izinReason = document.getElementById('izinReasonNoWifi');
            const customReasonContainer = document.getElementById('customReasonContainerNoWifi');

            if (izinReason.value === 'lainnya') {
                customReasonContainer.classList.remove('hidden');
            } else {
                customReasonContainer.classList.add('hidden');
            }
        }

        function handleIzinFileSelectNoWifi(event) {
            const file = event.target.files[0];
            if (file) {
                // Validasi ukuran file (max 5MB)
                if (file.size > 5 * 1024 * 1024) {
                    showToast('File Terlalu Besar', 'Ukuran file maksimal 5MB', 'error');
                    event.target.value = '';
                    return;
                }

                // Tampilkan preview
                document.getElementById('izinUploadPlaceholderNoWifi').classList.add('hidden');
                document.getElementById('izinFilePreviewNoWifi').classList.remove('hidden');
                document.getElementById('izinFileNameNoWifi').textContent = file.name;
            }
        }

        function removeIzinFileNoWifi(event) {
            event.stopPropagation();
            document.getElementById('izinFileUploadNoWifi').value = '';
            document.getElementById('izinUploadPlaceholderNoWifi').classList.remove('hidden');
            document.getElementById('izinFilePreviewNoWifi').classList.add('hidden');
        }

        function submitIzinNoWifi() {
            const nim = document.getElementById('nimInputNoWifi').value.trim();
            const izinReason = document.getElementById('izinReasonNoWifi').value;

            if (!nim) {
                showToast('NIM Kosong', 'Silakan masukkan NIM Anda', 'warning');
                return;
            }

            if (!izinReason) {
                showToast('Alasan Izin Kosong', 'Silakan pilih alasan izin', 'warning');
                return;
            }

            if (izinReason === 'lainnya') {
                const customReason = document.getElementById('customReasonNoWifi').value.trim();
                if (!customReason) {
                    showToast('Detail Alasan Kosong', 'Silakan jelaskan alasan izin Anda', 'warning');
                    return;
                }
            }

            const izinButton = document.getElementById('izinButtonNoWifi');
            const originalHTML = izinButton.innerHTML;
            izinButton.disabled = true;
            izinButton.innerHTML = `
                <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                Memverifikasi...
            `;

            // Simulasi verifikasi ke database
            setTimeout(() => {
                const studentData = studentDatabase[nim];

                if (!studentData) {
                    showToast('NIM Tidak Ditemukan', 'NIM yang Anda masukkan tidak terdaftar', 'error');
                    izinButton.disabled = false;
                    izinButton.innerHTML = originalHTML;
                    return;
                }

                // Cek apakah NIM sesuai dengan user yang login
                if (studentData.nim !== currentUser.nim) {
                    showToast('Data Tidak Sesuai', 'NIM tidak sesuai dengan akun yang login', 'error');
                    izinButton.disabled = false;
                    izinButton.innerHTML = originalHTML;
                    return;
                }

                // Simulasi penyimpanan izin
                setTimeout(() => {
                    const reasonText = izinReason === 'lainnya'
                        ? document.getElementById('customReasonNoWifi').value
                        : document.getElementById('izinReasonNoWifi').options[document.getElementById('izinReasonNoWifi').selectedIndex].text;

                    showToast('Permohonan Izin Terkirim! ✓', `Izin Anda (${reasonText}) telah tercatat dan menunggu persetujuan dosen`, 'success');

                    izinButton.disabled = false;
                    izinButton.className = 'w-full bg-green-600 hover:bg-green-700 text-white py-3.5 rounded-xl font-semibold transition shadow-lg shadow-green-600/30 flex items-center justify-center gap-2';
                    izinButton.innerHTML = `
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                        </svg>
                        Permohonan Izin Terkirim
                    `;

                    // Auto close modal after 2 seconds
                    setTimeout(() => {
                        closeModal();
                    }, 2000);
                }, 1000);
            }, 1500);
        }

        function toggleCustomReason() {
            const izinReason = document.getElementById('izinReason');
            const customReasonContainer = document.getElementById('customReasonContainer');

            if (izinReason.value === 'lainnya') {
                customReasonContainer.classList.remove('hidden');
            } else {
                customReasonContainer.classList.add('hidden');
            }
        }

        function handleIzinFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                // Validasi ukuran file (max 5MB)
                if (file.size > 5 * 1024 * 1024) {
                    showToast('File Terlalu Besar', 'Ukuran file maksimal 5MB', 'error');
                    event.target.value = '';
                    return;
                }

                // Tampilkan preview
                document.getElementById('izinUploadPlaceholder').classList.add('hidden');
                document.getElementById('izinFilePreview').classList.remove('hidden');
                document.getElementById('izinFileName').textContent = file.name;
            }
        }

        function removeIzinFile(event) {
            event.stopPropagation();
            document.getElementById('izinFileUpload').value = '';
            document.getElementById('izinUploadPlaceholder').classList.remove('hidden');
            document.getElementById('izinFilePreview').classList.add('hidden');
        }

        function showToast(title, message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastIcon = document.getElementById('toastIcon');
            const toastTitle = document.getElementById('toastTitle');
            const toastMessage = document.getElementById('toastMessage');

            // Set icon based on type
            if (type === 'success') {
                toastIcon.innerHTML = `
                    <div class="bg-green-500 p-2 rounded-full">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                        </svg>
                    </div>
                `;
            } else if (type === 'error') {
                toastIcon.innerHTML = `
                    <div class="bg-red-500 p-2 rounded-full">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </div>
                `;
            } else if (type === 'warning') {
                toastIcon.innerHTML = `
                    <div class="bg-amber-500 p-2 rounded-full">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                        </svg>
                    </div>
                `;
            }

            toastTitle.textContent = title;
            toastMessage.textContent = message;

            // Show toast
            toast.classList.remove('hidden');

            // Hide after 3 seconds
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 3000);
        }

        function checkWiFi() {
            const wifiNotConnected = document.getElementById('wifiNotConnected');
            const wifiConnected = document.getElementById('wifiConnected');
            const attendanceForm = document.getElementById('attendanceForm');
            const attendButton = document.getElementById('attendButton');

            // Demo: Always connect successfully when button is clicked
            attendButton.disabled = true;
            attendButton.innerHTML = `
                <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                Memeriksa WiFi...
            `;

            setTimeout(() => {
                // Always connect for demo
                isWifiConnected = true;
                wifiNotConnected.classList.add('hidden');
                wifiConnected.classList.remove('hidden');
                attendanceForm.classList.remove('hidden');
                showToast('WiFi Terhubung', 'Berhasil terhubung ke WiFi Kampus-IT', 'success');

                attendButton.disabled = false;
                attendButton.innerHTML = `
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    Verifikasi & Absen
                `;
            }, 1500);
        }

        function verifyAndAttend() {
            const nim = document.getElementById('nimInput').value.trim();

            if (!nim) {
                showToast('NIM Kosong', 'Silakan masukkan NIM Anda', 'warning');
                return;
            }

            // Harus terhubung WiFi untuk hadir
            if (!isWifiConnected) {
                showToast('WiFi Tidak Terhubung', 'Hubungkan ke WiFi Kampus terlebih dahulu', 'error');
                return;
            }

            const attendButton = document.getElementById('attendButton');
            const originalHTML = attendButton.innerHTML;
            attendButton.disabled = true;
            attendButton.innerHTML = `
                <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                Memverifikasi...
            `;

            // Simulasi verifikasi ke database
            setTimeout(() => {
                const studentData = studentDatabase[nim];

                if (!studentData) {
                    showToast('NIM Tidak Ditemukan', 'NIM yang Anda masukkan tidak terdaftar', 'error');
                    attendButton.disabled = false;
                    attendButton.innerHTML = originalHTML;
                    return;
                }

                // Cek apakah NIM sesuai dengan user yang login
                if (studentData.nim !== currentUser.nim) {
                    showToast('Data Tidak Sesuai', 'NIM tidak sesuai dengan akun yang login', 'error');
                    attendButton.disabled = false;
                    attendButton.innerHTML = originalHTML;
                    return;
                }

                // Tampilkan preview data
                document.getElementById('verifiedName').textContent = studentData.name;
                document.getElementById('verifiedNim').textContent = 'NIM: ' + studentData.nim;
                document.getElementById('verifiedProdi').textContent = studentData.prodi;
                document.getElementById('verifiedYear').textContent = studentData.year;
                document.getElementById('userDataPreview').classList.remove('hidden');

                // Simulasi penyimpanan absensi hadir
                setTimeout(() => {
                    showToast('Absensi Berhasil! ✓', `Terima kasih ${studentData.name}, kehadiran Anda telah tercatat`, 'success');

                    attendButton.disabled = false;
                    attendButton.className = 'w-full bg-green-600 hover:bg-green-700 text-white py-3.5 rounded-xl font-semibold transition shadow-lg shadow-green-600/30 flex items-center justify-center gap-2';
                    attendButton.innerHTML = `
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                        </svg>
                        Absensi Berhasil
                    `;

                    // Auto close modal after 2 seconds
                    setTimeout(() => {
                        closeModal();
                    }, 2000);
                }, 1000);
            }, 1500);
        }

        // Auto focus on NIM input when form is shown
        const nimInput = document.getElementById('nimInput');
        const nimInputNoWifi = document.getElementById('nimInputNoWifi');

        if (nimInput) {
            nimInput.addEventListener('input', function (e) {
                // Only allow numbers
                this.value = this.value.replace(/[^0-9]/g, '');
            });
        }

        if (nimInputNoWifi) {
            nimInputNoWifi.addEventListener('input', function (e) {
                // Only allow numbers
                this.value = this.value.replace(/[^0-9]/g, '');
            });
        }
    </script>
</body>

</html>