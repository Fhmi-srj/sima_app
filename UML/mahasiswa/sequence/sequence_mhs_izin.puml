@startuml Sequence Diagram - Mengajukan Izin Mahasiswa

title Sequence Diagram: Mengajukan Izin Mahasiswa

actor Mahasiswa as mhs
participant "Form Izin" as form
participant "Izin Controller" as ctrl
participant "File Service" as file
participant "Dosen" as dosen
database "Database" as db

mhs -> form : Buka form izin
activate form

form --> mhs : Tampilkan form\n(Jenis, Alasan, Upload Bukti)

mhs -> form : Pilih jenis izin\n(Sakit/Izin/Cuti)
mhs -> form : Isi alasan izin

opt Upload Bukti
    mhs -> form : Tap upload bukti
    form -> file : selectFile()
    activate file
    file --> form : Selected file
    deactivate file
    
    form -> file : validateFile(file)
    activate file
    alt File Valid
        file --> form : File OK
        form --> mhs : Tampilkan preview file
    else File Invalid
        file --> form : Error: Format tidak didukung
        form --> mhs : Tampilkan error
    end
    deactivate file
end

mhs -> form : Tap Submit
form -> ctrl : validateForm()
activate ctrl

alt Form Lengkap
    ctrl -> file : uploadFile(file)
    activate file
    file --> ctrl : File URL
    deactivate file
    
    ctrl -> db : INSERT izin_request
    activate db
    db --> ctrl : Request ID
    deactivate db
    
    ctrl -> dosen : sendNotification(new_izin_request)
    
    ctrl --> form : Success
    deactivate ctrl
    
    form --> mhs : Tampilkan "Izin Terkirim"\nStatus: Menunggu Persetujuan
    
else Form Tidak Lengkap
    ctrl --> form : Error: Field wajib kosong
    deactivate ctrl
    form --> mhs : Tampilkan error validasi
end

deactivate form

@enduml
